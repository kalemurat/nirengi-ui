/* select.component.scss */
@use 'sass:map';

.nui-select {
  @apply relative flex w-full flex-col gap-1.5;

  /* Gap map from size constants */
  &--xs {
    .nui-select__label {
      @apply text-xs;
    }

    .nui-select__hint,
    .nui-select__success,
    .nui-select__warning {
      @apply text-[10px];
    }
  }

  &--sm {
    .nui-select__label {
      @apply text-sm;
    }

    .nui-select__hint,
    .nui-select__success,
    .nui-select__warning {
      @apply text-xs;
    }
  }

  &--md {
    .nui-select__label {
      @apply text-sm;
    }

    .nui-select__hint,
    .nui-select__success,
    .nui-select__warning {
      @apply text-xs;
    }
  }

  &--lg {
    .nui-select__label {
      @apply text-base;
    }

    .nui-select__hint,
    .nui-select__success,
    .nui-select__warning {
      @apply text-sm;
    }
  }

  &--xl {
    .nui-select__label {
      @apply text-lg;
    }

    .nui-select__hint,
    .nui-select__success,
    .nui-select__warning {
      @apply text-base;
    }
  }

  /* Variant modifiers (block-level). These allow `nui-select--primary` etc. */
  &--primary {
    .nui-select__trigger {
      @apply border-primary-500 text-primary-700 placeholder-primary-300 focus:ring-primary-500;
    }

    .nui-select__icon {
      @apply text-primary-500;
    }

    .nui-select__clear {
      @apply text-primary-500;
    }

    .nui-select__label {
      @apply text-primary-700;
    }

    .nui-select__hint {
      @apply text-primary-500;
    }
  }

  &--secondary {
    .nui-select__trigger {
      @apply border-default text-primary placeholder:text-tertiary focus:ring-default;
    }

    .nui-select__icon {
      @apply text-tertiary;
    }

    .nui-select__label {
      @apply text-primary;
    }

    .nui-select__hint {
      @apply text-secondary;
    }
  }

  &--danger {
    .nui-select__trigger {
      @apply border-danger-600 text-danger-700 placeholder-danger-300 focus:ring-danger-600;
    }

    .nui-select__icon,
    .nui-select__clear {
      @apply text-danger-600;
    }

    .nui-select__label {
      @apply text-danger-700;
    }

    .nui-select__hint {
      @apply text-danger-600;
    }
  }

  &--success {
    .nui-select__trigger {
      @apply border-success-500 text-success-900 placeholder-success-300 focus:ring-success-500;
    }

    .nui-select__icon,
    .nui-select__clear {
      @apply text-success-500;
    }

    .nui-select__label {
      @apply text-success-700;
    }

    .nui-select__hint {
      @apply text-success-600;
    }
  }

  &--warning {
    .nui-select__trigger {
      @apply border-warning-500 text-warning-900 placeholder-warning-300 focus:ring-warning-500;
    }

    .nui-select__icon,
    .nui-select__clear {
      @apply text-warning-600;
    }

    .nui-select__label {
      @apply text-warning-800;
    }

    .nui-select__hint {
      @apply text-warning-700;
    }
  }

  &--info {
    .nui-select__trigger {
      @apply border-info-500 text-info-700 placeholder-info-300 focus:ring-info-500;
    }

    .nui-select__icon {
      @apply text-info-500;
    }

    .nui-select__label {
      @apply text-info-700;
    }

    .nui-select__hint {
      @apply text-info-600;
    }
  }

  &--neutral {
    .nui-select__trigger {
      @apply border-default text-primary placeholder:text-tertiary focus:ring-default;
    }

    .nui-select__icon {
      @apply text-tertiary;
    }

    .nui-select__label {
      @apply text-primary;
    }

    .nui-select__hint {
      @apply text-secondary;
    }
  }

  &__label {
    @apply block text-sm font-medium text-primary;
  }

  &__container {
    @apply relative w-full;
  }

  &__trigger {
    @apply flex w-full cursor-pointer items-center justify-between rounded-md border bg-primary transition-colors duration-200;
    @apply border-default text-left text-primary;
    @apply focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-500;

    /* Sizes */
    &--xs {
      @apply h-8 px-2.5 text-xs;
    }

    &--sm {
      @apply h-9 px-3 text-sm;
    }

    &--md {
      @apply h-10 px-3.5 text-sm;
    }

    &--lg {
      @apply h-11 px-4 text-base;
    }

    &--xl {
      @apply h-12 px-5 text-lg;
    }

    /* States */
    &__trigger--disabled {
      @apply pointer-events-none cursor-not-allowed border-default bg-tertiary text-disabled;
    }

    &--success {
      @apply border-success-500 text-success-900 placeholder-success-300 focus:ring-success-500;
    }

    &--warning {
      @apply border-warning-500 text-warning-900 placeholder-warning-300 focus:ring-warning-500;
    }

    &--open {
      @apply border-primary-500 ring-2 ring-primary-500 ring-opacity-20;
    }
  }

  &__value {
    @apply mr-2 flex flex-1 items-center overflow-hidden;
    /* Remove simple truncate here as it conflicts with chips container flex layout */

    &--placeholder {
      @apply truncate text-tertiary;
    }
  }

  &__chips {
    /* Prevents wrapping, hides overflow, adds spacing */
    @apply flex w-full flex-nowrap items-center gap-1 overflow-hidden py-1;

    /* Mask to fade out the end if items overflow */
    mask-image: linear-gradient(to right, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
  }

  &__chip {
    @apply flex items-center whitespace-nowrap rounded border border-subtle bg-tertiary px-1.5 py-0.5 text-xs font-medium text-primary;
    /* flex-shrink-0 prevents squashing, ensuring whole chips are either seen or hidden/cut off */
    @apply flex-shrink-0;

    &--remove {
      @apply ml-1 cursor-pointer text-neutral-400 hover:text-neutral-600;
    }
  }

  &__clear {
    @apply z-10 mr-1 flex cursor-pointer items-center justify-center rounded-full p-1 text-neutral-400 transition-colors;
    @apply hover:bg-neutral-100 hover:text-neutral-600;

    /* Status colors */
    .nui-select__trigger--error & {
      @apply text-danger-500;
    }

    .nui-select__trigger--success & {
      @apply text-success-500;
    }

    .nui-select__trigger--warning & {
      @apply text-warning-600;
    }
  }

  &__icon {
    @apply flex flex-shrink-0 items-center justify-center text-tertiary transition-transform duration-200;

    &--open {
      @apply rotate-180 transform;
    }

    /* Status colors: inherit from parent modifier */
    .nui-select__trigger--error & {
      @apply text-danger-500;
    }

    .nui-select__trigger--success & {
      @apply text-success-500;
    }

    .nui-select__trigger--warning & {
      @apply text-warning-600;
    }
  }

  &__dropdown {
    @apply absolute left-0 right-0 z-50 mt-1 overflow-hidden rounded-md border border-default bg-primary shadow-lg;

    /* If appended to body, reset positioning as overlay handles it */
    &--overlay {
      @apply static mt-0 border border-default;
    }
  }

  /* Global Overlay Styles */
  .nui-select-overlay {
    /* Ensure the overlay panel itself doesn't have padding/margin messing up */
    @apply bg-transparent;

    /* Since we lose the parent .nui-select--xs etc scope, we must ensure these classes on the overlay panel trigger the children styles */
    /* The children styles (search input, etc) are scoped using .nui-select--xs parent */
    /* So adding .nui-select--xs to the overlay panel (which we did in TS) should work IF the SCSS nesting supports it being on the root of the overlay */
  }

  &__search {
    @apply border-b border-neutral-100 p-2;

    &-input {
      @apply w-full rounded-md border border-default bg-secondary text-primary;
      @apply focus:border-primary-500 focus:bg-primary focus:outline-none focus:ring-1 focus:ring-primary-500;
      @apply placeholder-tertiary;

      /* Parent size modifier mapping via at-root or manual class check */
      .nui-select--xs & {
        @apply px-2 py-1 text-xs;
      }

      .nui-select--sm & {
        @apply px-2.5 py-1.5 text-sm;
      }

      .nui-select--md & {
        @apply px-3 py-2 text-sm;
      }

      .nui-select--lg & {
        @apply px-3.5 py-2.5 text-base;
      }

      .nui-select--xl & {
        @apply px-4 py-3 text-lg;
      }
    }
  }

  &__options {
    @apply max-h-60 overflow-y-auto py-1;
  }

  &__option {
    @apply flex cursor-pointer select-none items-center px-3 py-2 text-sm text-primary transition-colors;
    @apply hover:bg-secondary;

    &--selected {
      @apply bg-primary-50 font-medium text-primary-700;
      @apply dark:bg-primary-900/20 dark:text-primary-400;

      &:hover {
        @apply bg-primary-50;
      }
    }

    &--disabled {
      @apply cursor-not-allowed bg-transparent opacity-50 hover:bg-transparent;
    }

    /* Checkmark place */
    &-check {
      @apply ml-auto text-primary-600;
    }
  }

  &__empty {
    @apply px-3 py-4 text-center text-sm text-secondary;
  }

  &__hint {
    @apply text-xs text-secondary;
  }

  &__success {
    @apply text-xs text-success-600;
  }

  &__warning {
    @apply text-xs text-warning-600;
  }
}
